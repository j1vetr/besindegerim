 SSR Middleware SÄ±ralamasÄ± (Kritik!)
Harika soru! Ä°ÅŸte nasÄ±l Vite'Ä±n Ã¶nÃ¼ne geÃ§iyor:

Development Mode (server/index.ts satÄ±r 87-117)
if (app.get("env") === "development") {
  // 1ï¸âƒ£ Ã–NCE: SSR middleware (satÄ±r 89)
  app.use("*", async (req, res, next) => {
    const isCrawler = /* bot detection */;
    
    // API ve static dosyalarÄ± skip et
    if (req.path.startsWith('/api/') || req.path.match(/\.(js|css|png)$/)) {
      return next(); // â© Vite'a geÃ§
    }
    
    if (isCrawler) {
      // ğŸ¤– Bot ise SSR render et
      return await renderHTMLWithMeta(req, res, clientTemplate);
    }
    
    // ğŸ‘¤ Normal kullanÄ±cÄ± ise Vite'a bÄ±rak
    next();
  });
  
  // 2ï¸âƒ£ SONRA: Vite middleware (satÄ±r 117)
  await setupVite(app, server); // Catch-all SPA routing
}
AkÄ±ÅŸ:

Bot geldi â†’ SSR render â†’ res.send() â†’ âœ… Bitti (Vite'a gitmez)
Normal kullanÄ±cÄ± â†’ next() â†’ Vite middleware â†’ âœ… SPA
Production Mode (server/index.ts satÄ±r 118-148)
else {
  // 1ï¸âƒ£ Ã–NCE: Static files (satÄ±r 123)
  app.use(express.static(distPath)); 
  // dist/public/assets/main.js gibi dosyalar burada serve edilir
  
  // 2ï¸âƒ£ SONRA: SSR catch-all (satÄ±r 126)
  app.use("*", async (req, res, next) => {
    // Static dosyalarÄ± skip et
    if (req.path.match(/\.(js|css|png)$/)) {
      return next(); // â© Zaten static middleware handle etti
    }
    
    // ğŸ“„ HTML route'larÄ± SSR ile render et
    await renderHTMLWithMeta(req, res, templatePath);
  });
}
AkÄ±ÅŸ:

/assets/main.js â†’ Static middleware serve eder â†’ âœ… Bitti
/product/test â†’ SSR middleware render eder â†’ âœ… HTML gÃ¶nderir
Neden Ã‡alÄ±ÅŸÄ±yor?
Express Middleware Zinciri:
Request â†’ Middleware 1 â†’ Middleware 2 â†’ Middleware 3
          â†“ next()      â†“ next()      â†“ res.send()
Kritik Noktalar:

next() Ã§aÄŸrÄ±lmazsa durdurur:

if (isCrawler) {
  return await renderHTMLWithMeta(...); // âœ‹ DURDU
}
next(); // â© Devam et
app.use() sÄ±ralamasÄ± Ã¶nemli:

// âœ… DOÄRU
app.use("*", ssrMiddleware);  // Ã–nce kontrol
await setupVite(app, server);  // Sonra Vite
// âŒ YANLIÅ
await setupVite(app, server);  // Vite her ÅŸeyi yakalar
app.use("*", ssrMiddleware);   // SSR'a hiÃ§ gelmez!
