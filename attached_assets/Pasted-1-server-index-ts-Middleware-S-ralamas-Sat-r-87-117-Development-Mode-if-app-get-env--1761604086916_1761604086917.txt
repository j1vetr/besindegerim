1ï¸âƒ£ server/index.ts (Middleware SÄ±ralamasÄ±)
SatÄ±r 87-117 â†’ Development Mode:

if (app.get("env") === "development") {
  // âœ… Ã–NCE SSR middleware
  app.use("*", async (req, res, next) => {
    const isCrawler = /* bot detection */;
    
    if (isCrawler) {
      // ğŸ¤– Bot â†’ SSR render
      return await renderHTMLWithMeta(req, res, clientTemplate);
    }
    
    // ğŸ‘¤ Normal kullanÄ±cÄ± â†’ Vite'a geÃ§
    next();
  });
  
  // âœ… SONRA Vite middleware
  await setupVite(app, server);
}
SatÄ±r 118-148 â†’ Production Mode:

else {
  // âœ… Ã–NCE static files
  app.use(express.static(distPath));
  
  // âœ… SONRA SSR catch-all
  app.use("*", async (req, res, next) => {
    // Static dosyalarÄ± skip et
    if (req.path.match(/\.(js|css|png)$/)) {
      return next();
    }
    
    // ğŸ“„ HTML route'larÄ± SSR ile render et
    await renderHTMLWithMeta(req, res, templatePath);
  });
}
2ï¸âƒ£ server/ssr.ts (SSR Orchestration)
renderHTMLWithMeta() (SatÄ±r 24-131):

export async function renderHTMLWithMeta(req, res, templatePath) {
  // 1. URL'i parse et
  const url = req.originalUrl.split("?")[0];
  
  // 2. Hangi sayfayÄ± render edeceÄŸine karar ver
  if (url === "/") {
    const result = await renderHomePage(); // â† Pure HTML string
  } else if (url.match(/^\/nasil-oldu\/([^/]+)/)) {
    const result = await renderPersonDetailPage(slug); // â† Pure HTML string
  }
  
  // 3. Meta tag'leri oluÅŸtur
  const meta = await generateMetaTags(url);
  
  // 4. HTML template'ini oku
  let html = await fs.promises.readFile(templatePath, "utf-8");
  
  // 5. Meta tag'leri inject et (REPLACE strategy)
  html = injectMetaTagsWithPlaceholders(html, meta);
  
  // 6. Body content'i inject et
  html = html.replace(
    '<div id="root"></div>',
    `<div id="root">${renderedContent}</div>`
  );
  
  // 7. GÃ¶nder
  res.status(statusCode).send(html);
}
injectMetaTagsWithPlaceholders() (SatÄ±r 136-232):

// REPLACE strategy (duplicate Ã¶nler)
result = result.replace(/<title>.*?<\/title>/, `<title>${meta.title}</title>`);
result = result.replace(/<meta name="description"[^>]*>/, `<meta name="description" content="${meta.description}" />`);
result = result.replace(/<meta property="og:title"[^>]*>/, `<meta property="og:title" content="${meta.title}" />`);
3ï¸âƒ£ server/render.ts (Pure HTML Rendering)
renderHomePage() (SatÄ±r 112-180):

export async function renderHomePage(): Promise<RenderResult> {
  const stats = await storage.getStats();
  const recentPersons = await storage.getRecentPersons(6);
  
  // âœ… Pure HTML string (React component deÄŸil!)
  const html = `
    <div class="container mx-auto px-4 py-8">
      <h1 class="text-5xl font-bold">${stats.totalPersons}+ ÃœnlÃ¼</h1>
      <div class="grid grid-cols-3 gap-6">
        ${recentPersons.map(p => `
          <article>
            <img src="${p.imageUrl}" alt="${p.name}" />
            <h3>${p.name}</h3>
          </article>
        `).join('')}
      </div>
    </div>
    ${renderFooter()}
  `;
  
  return { html, statusCode: 200 };
}
renderPersonDetailPage() (SatÄ±r 185-330+):

export async function renderPersonDetailPage(slug): Promise<RenderResult> {
  const person = await storage.getPersonBySlug(slug);
  
  if (!person) {
    return { 
      html: '<h1>404</h1>', 
      statusCode: 404 
    };
  }
  
  // âœ… Pure HTML string
  const html = `
    <div class="container">
      <h1>${person.name}</h1>
      <img src="${person.imageUrl}" />
      <p>${person.description}</p>
    </div>
    ${renderFooter()}
  `;
  
  return { html, statusCode: 200 };
}
renderFooter() (SatÄ±r 17-107):

// âœ… Reusable HTML component (helper function)
function renderFooter(): string {
  return `
    <footer class="border-t bg-card">
      <div class="container">
        <p>&copy; ${new Date().getFullYear()} nasiloldu.net</p>
      </div>
    </footer>
  `;
}
4ï¸âƒ£ server/seo/meta-inject.ts (Meta Tag Generation)
generateMetaTags() (SatÄ±r 24-314):

export async function generateMetaTags(url: string): Promise<MetaTags | null> {
  // Ana sayfa
  if (url === '/') {
    return {
      title: 'ÃœnlÃ¼ KiÅŸiler NasÄ±l Ã–ldÃ¼? | nasiloldu.net',
      description: '236+ Ã¼nlÃ¼ kiÅŸinin Ã¶lÃ¼m nedenleri...',
      canonical: 'https://nasiloldu.net',
      ogType: 'website',
      keywords: 'Ã¼nlÃ¼ Ã¶lÃ¼mler, ...',
      schema: { '@type': 'WebSite', ... }
    };
  }
  
  // KiÅŸi detay
  const personMatch = url.match(/^\/nasil-oldu\/([^/]+)/);
  if (personMatch) {
    const person = await db.query.persons.findFirst(...);
    return {
      title: `${person.name} NasÄ±l Ã–ldÃ¼? | nasiloldu.net`,
      description: generateDeathStory(person),
      ogImage: person.imageUrl,
      keywords: `${person.name} nasÄ±l Ã¶ldÃ¼, ...`,
      schema: { '@type': 'Person', ... }
    };
  }
}